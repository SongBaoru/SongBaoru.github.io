---
title: Kafka
date: 2023-05-06 11:03:13
toc: true
cover: https://th.bing.com/th/id/R.1558dba9f9181fbad6098a4e5d4d161d?rik=Fznzl57FcUoALA&riu=http%3a%2f%2fpic4.nipic.com%2f20090803%2f3139674_170434025_2.jpg&ehk=V2HHRSsszzKlfPrGelIZYMqLy0w1Zf6Xc5qeGx2NVxA%3d&risl=&pid=ImgRaw&r=0
categories: IT
tags:
  - Kafka
---

# 消息引擎系统

设计消息引擎系统（消息中间件）需要考虑的重要因素：

1. 消息设计

   Kafka的消息是使用二进制的方式保存，但是依然是结构化的消息。

2. 传输协议设计

   Kafka自己设计了一套二进制的消息传输协议，而没有采用现有的序列化框架（如Protocol Buffers）和RPC框架（如Dubbo）。

kafka做到高吞吐、低延时的原因：

1. 使用了操作系统的页缓存技术

   - 操作系统的页缓存是在内存中分配的，读写速度快

2. Kafka的写入操作采用追加写入（append）的方式，避免了磁盘的随机写操作

3. 使用了零拷贝技术

   Kafka在读取消息时会首先尝试从操作系统的页缓存中读取，如果命中就将页缓存中的消息直接发送到网络的Socket上，不需要再经过应用缓存，减少了数据拷贝的次数。

   一个经过良好调优的Kafka服务器（broker）即使在负载较高的情况下，其磁盘的读操作也很少，因为大部分的消息读取操作会直接命中页缓存。

消息持久化

# Kafka的使用场景



# Kafka体系架构

主题、分区、副本

生产者

消费者与消费组

消息服务器

# 生产者

## 消息发送模式

## 分区机制

## 压缩机制

## 拦截器



# 消费者

## 消费模式

### 推送模式

### 拉取模式

### 消费者组

### 偏移量

### 分区

### 拦截器



# 服务端

## 主题和分区

## 消息的持久性

## 消息的传输保障

## 副本和Leader选举

## 高水位线

## 日志压缩与删除



# 消息处理模式

消息广播

消息过滤

消息批处理

日志消息处理

通信模块



消息结构



数据存储

数据刷盘
